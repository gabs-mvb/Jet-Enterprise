<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Produtos</title>
  <link rel="stylesheet" href="css/perfil-sidebar.css" />
  <link rel="stylesheet" href="css/perfil-produtos-mercearia.css" />
  <link rel="stylesheet" href="css/perfil-produtos.css">
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.min.css'>
</head>

<body onload="atualizartabela()">

  <section>

    <!-- Titulo da página -->
    <section class="titulo-pagina">
      <h1>Configurações dos produtos</h1>
    </section>


    <!--Setores do mercado-->
    <section class="cards">
      <div class="titulo-setor-card">
        <div class="container-setor-e-titulo">
          Setor :
          <span class="setor-titulo">
            Mercearia
          </span>
        </div>
      </div>

      <div class="setores-card">
        <div class="sessao-setores">
          <h2>Setores</h2>
        </div>
        <ul class="setores">
          <li>
            <a href="perfil-produtos-frios-congelados.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Frios e congelados
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-produtos-mercearia.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Mercearia
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-produtos-hortifruti.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Hortifruti
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-produtos-cuidados-pessoais.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Cuidados Pessoais
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-produtos-bebidas.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Bebidas
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
        </ul>
      </div>
      <div class="kpis-card">
        <table class="tabela">
          <thead>
              <tr class="tr_table">
              <th class="th_table">Prateleira(s)</th>
              <th class="th_table">Produto</th>
              </tr>
          </thead>
          <tbody id="tbody_table">
          </tbody>
        </table> 
      </div>
    </section>


    <!-- Fundo azul e Sidebar -->

    <!-- Fundo Azul -->
    <section class="background-color">

      <!-- SideBar do Perfil -->
      <div class="sidebar">
        <img src="uploads/user.svg" id="iconePerfil" class="icone-perfil" />
        <h3><span id="b_usuario">Nome Completo</span></h3>
        <nav>
          <ul class="sidebar-lista">
            <li>
              <a href="perfil-dashboard-empresa.html">
                <img src="assets/svg/empresa.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
    
                <span href="perfil-dashboard-empresa.html" class="sidebar-titulo">Empresa</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-produtos-frios-congelados.html">
                <img src="assets/svg/produtos.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Produtos</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-dashboard-geral.html">
                <img src="assets/svg/dashboard.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Dashboard</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-notificacoes.html">
                <img src="assets/svg/notificacoes.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Notificações</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-config.html">
                <img src="assets/svg/configuracoes.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Configurações</span>
              </a>
            </li>
            <li>
              <a href="https://suportejet.auvo.com.br/Ticket/Novo" target="_blank">
                <img src="assets/svg/suporte.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Suporte</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="index.html">
                <img src="assets/svg/logo.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
    
                <span class="sidebar-titulo">JET - Tela Inicial</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </section>

    <!-- Tabela dos produtos -->
    <!--Espaço vazio no fim do dashboard-->
    <section class="footer-space"></section>

</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.all.min.js"></script>
<script src="./js/perfil-produtos.js"></script>
<script>
  iconePerfil.src = sessionStorage.PERFIL_IMAGEM;
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
</script>
<script>
  function atualizartabela() {
    var idEmpresa = sessionStorage.ID_EMPRESA;
  

    fetch(`/produtos/listarprodutosMercearia/${idEmpresa}`).then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Nenhum produto encontrado!',
          })
        }
        resposta.json().then(function (resposta) {
          console.log("Dados recebidos: ", JSON.stringify(resposta));

          var tabela = document.getElementById("tbody_table");

          tabela.innerHTML = "";
          for (let i = resposta.length-1; i >= 0; i--) {
            var itens = resposta[i];

            var linhaTabela = document.createElement("tr");
            var colunaTabela1 = document.createElement("td");
            var colunaTabela2 = document.createElement("td");

            colunaTabela2.id = 18-i;

            colunaTabela1.innerHTML = 18-i;
            colunaTabela2.innerHTML = `${itens.nomeProduto} <img class="icon_editar" src="./assets/svg/icon_editar.svg" alt="" onclick="editar_produto(${itens.idProduto})">`;

            linhaTabela.className = "tr_table";
            colunaTabela1.className = "td_table"
            colunaTabela2.className = "td_table_produto"


            linhaTabela.appendChild(colunaTabela1);
            linhaTabela.appendChild(colunaTabela2);
            tabela.appendChild(linhaTabela);
          }
        });
      } else {
        throw ('Houve um erro na API!');
      }
    }).catch(function (resposta) {
      console.error(resposta);
    });
  }
  function editar_produto(idProduto){
    sessionStorage.ID_PRODUTO_EDITANDO = idProduto;
    var idProduto = document.getElementById(idProduto)
    idProduto.innerHTML = ` 
      <input class="input_produto" placeholder="Nome do produto*" type="text" id="input_produto">
      <button class="btn_adicionar_produto" onclick="confirmarProduto()">Confirmar</button>
    `
  }


  function confirmarProduto(){
    var nomeProduto = input_produto.value;
    var idProduto = sessionStorage.ID_PRODUTO_EDITANDO;

    fetch(`/produtos/confirmarProduto/${sessionStorage.getItem("ID_PRODUTO_EDITANDO")}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        nome: nomeProduto,
        idProduto: idProduto,
      })
    }).then(function (resposta) {
      
      if (resposta.ok) {
        Swal.fire({
          icon: 'success',
          title: 'Parabéns',
          text: 'Produto atualizado com sucesso!',
          })
          setTimeout(() => window.location = "./perfil-produtos-mercearia.html", 2000);
          
      } else if (resposta.status == 404) {
        Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Deu 404!',
          })
      } else {
        throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
    })
  }

</script>