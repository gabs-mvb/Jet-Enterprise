<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Setor:Cuidados pessoais</title>
  <link rel="stylesheet" href="css/perfil-sidebar.css">
  <link rel="stylesheet" href="css/perfil-dashboard-sensores-cuidados-pessoais.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.min.css'>

</head>

<body onload="buscarDadosBolinhas(), mostrarkpi(), kpiAunsencia(), obterPolar()">

  <header>

    <!--Titulo do dashboard-->
    <section class="dashboard-titulo">
      <h1>Estado dos sensores</h1>
    </section>

  </header>

  <main>

    <!--Dashboard-->

    <!--Titulo setor-->
    <section class="container-setor">
      <div class="container-setor-e-titulo">
        Setor :
        <span class="setor-titulo">
          Cuidados pessoais
        </span>
      </div>
    </section>


    <!--Sessão de KPIs-->
    <section class="dashboard-kpis">

      <!--KPI sobre produtos sem estoque algum-->
      <div id="div_kpi_dadoEstoque" class="kpis kpi-estoque-setor-cuidados-pessoais">
        <p class="kpi-titulo">Sem estoque algum</p>
        <p id="kpi_dado_estoqueCuidados" class="kpi-dado"></p><span class="kpi-dado-palavra-ajuste">produtos</span>
      </div>

      <!--KPI sobre sensores detectando ausência de produtos-->
      <div id="div_kpi_dadoAusencia" class="kpis kpi-ausencia-setor-cuidados-pessoais">
        <p class="kpi-titulo">Ausência de produtos</p>
        <p id="kpi_dado_ausencia" class="kpi-dado"></p><span class="kpi-dado-palavra-ajuste">sensores</span>
      </div>

      <!--KPI sobre a porcentagem de abastecimento do mercado-->
      <div id="div_kpi_dado" class="kpis kpi-abastecimento-setor-cuidados-pessoais">
        <p class="kpi-titulo">Setor abastecido</p>
        <p id="kpi_dadoSetorCuidados" class="kpi-dado"></p>
      </div>

      <!--Gráfico polar sobre a falta dos produtos nos setores do mercado-->
      <div class="kpis kpi-grafico-polar">
        <div id="grafico" class="grafico-kpi-container grafico-container-polar-setores">
          <!-- <canvas class="graficos-canvas" id="polar_setor_falta_produto"></canvas> -->
        </div>
        <div class="kpi-grafico-titulos-container">
          <div class="kpi-grafico-titulo">
            Ausência de produtos em cada setor
          </div>
        </div>
      </div>
    </section>


    <!--Sessão de Gráficos dos produtos-->
    <section class="dashboard-graficos">
      <div class="graficos-card-produtos">
        <div class="produtos-titulo-e-legenda">
          <div class="titulo-produtos">
            Produtos
          </div>
          <div class="estado-produto-legenda">
            <img src="assets/perfil/dashboard/perfil-dashboard-sensores/bolinha-vermelha.svg"
              alt="Icone de ausência vermelho">
            - Ausência de produto
            <img src="assets/perfil/dashboard/perfil-dashboard-sensores/bolinha-verde.svg"
              alt="Icone de presença verde">
            - Presença de produto
          </div>
        </div>

        <div class="lista-produtos">
          <div class="lista-produtos-nomes">
            <ul class="lista-produtos-nome-ul" id="containerDashProdutos"></ul>

          </div>
        </div>

      </div>


      <!--Setores do mercado-->
      <div class="graficos-card">
        <div class="sessao-setores">
          <h2>Setores</h2>
        </div>
        <ul class="setores">
          <li>
            <a href="perfil-dashboard-sensores-frios-congelados.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Frios e congelados
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-dashboard-sensores-mercearia.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Mercearia
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-dashboard-sensores-hortifruti.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Hortifruti
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-dashboard-sensores-cuidados-pessoais.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Cuidados Pessoais
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="perfil-dashboard-sensores-bebidas.html">
              <div class="container-setores">
                <div class="titulos-setores">
                  Bebidas
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </section>

    <!--Categorias-->
    <section class="dashboard-sessoes">
      <div class="sessao-espaco-para-categorias">
      </div>
      <div class="sessoes sessao-categorias">
        <h2>Categorias</h2>
        <ul class="categorias">
          <li><a href="perfil-dashboard-geral.html">
              <div class="container-categorias">
                <div class="titulos-categorias">
                  Informações gerais
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a></li>
          <li><a href="perfil-dashboard-sensores-frios-congelados.html">
              <div class="container-categorias">
                <div class="titulos-categorias">
                  Estado dos sensores
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a></li>
          <li><a href="perfil-dashboard-produtos.html">
              <div class="container-categorias">
                <div class="titulos-categorias">
                  Fluxo dos produtos
                </div>
                <div>
                  <img src="assets/perfil/dashboard/seta-lateral.svg" class="svg-seta"
                    alt="Seta lateral indicando um link">
                </div>
              </div>
            </a></li>
        </ul>
      </div>
    </section>

    <!--Fundo Azul-->
    <section class="background-color">

      <!-- SideBar do Perfil-->
      <div class="sidebar">
        <img src="uploads/user.svg" id="iconePerfil" class="icone-perfil" />
        <h3><span id="b_usuario">Nome Completo</span></h3>
        <nav>
          <ul class="sidebar-lista">
            <li>
              <a href="perfil-dashboard-empresa.html">
                <img src="assets/svg/empresa.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
    
                <span href="perfil-dashboard-empresa.html" class="sidebar-titulo">Empresa</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-produtos-frios-congelados.html">
                <img src="assets/svg/produtos.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Produtos</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-dashboard-geral.html">
                <img src="assets/svg/dashboard.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Dashboard</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-notificacoes.html">
                <img src="assets/svg/notificacoes.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Notificações</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="perfil-config.html">
                <img src="assets/svg/configuracoes.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Configurações</span>
              </a>
            </li>
            <li>
              <a href="https://suportejet.auvo.com.br/Ticket/Novo" target="_blank">
                <img src="assets/svg/suporte.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
                <span class="sidebar-titulo">Suporte</span>
              </a>
            </li>
            <div class="sidebar-separacao"></div>
            <li>
              <a href="index.html">
                <img src="assets/svg/logo.svg" class="sidebar-icone-lista" width="50" height="54" viewBox="0 0 47 51" alt="">
    
                <span class="sidebar-titulo">JET - Tela Inicial</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </section>
  </main>

  <footer>
    <!--Espaço vazio no fim do dashboard-->
    <section class="footer-space"></section>

  </footer>

</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.all.min.js"></script>
<script src="js/perfil-dashboard-sensores.js"></script>

</html>
<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  iconePerfil.src = sessionStorage.PERFIL_IMAGEM;
  var faltaTotal = 0;
  var arrayBolinhas = [];

function buscarNomeProdutos() {
    var idEmpresa = sessionStorage.ID_EMPRESA;
    fetch(`/produtos/listarProdutosCuidados/${idEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
            if (resposta.status == 204) {
              Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Nenhum produto encontrado!',
          })
            }
            resposta.json().then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));


                var container = document.getElementById('containerDashProdutos')
                container.innerHTML = "";

                for (let i = resposta.length-1; i >= 0; i--) {
                    var itens = resposta[i];

                    if (arrayBolinhas[i] == 3) {
                        var bolinhas = `<span class="bolinha green"></span>
                                         <span class="bolinha green"></span>
                                           <span class="bolinha green"></span>`
                        mostrarFaltaTotal();
                    } else if (arrayBolinhas[i] == 2) {
                        var bolinhas = `<span class="bolinha green"></span>
                                         <span class="bolinha green"></span>
                                           <span class="bolinha red"></span>`
                        mostrarFaltaTotal();
                    } else if (arrayBolinhas[i] == 1) {
                        var bolinhas = `<span class="bolinha green"></span>
                                         <span class="bolinha red"></span>
                                           <span class="bolinha red"></span>`
                        mostrarFaltaTotal();

                    } else {
                        var bolinhas = `<span class="bolinha red"></span>
                                         <span class="bolinha red"></span>
                                           <span class="bolinha red"></span>`
                        faltaTotal += 1;
                        mostrarFaltaTotal();
                    }


                    var lista = document.createElement('li')
                    container.appendChild(lista)
                    lista.innerHTML = `
                                            <div class="lista-produtos-nome-li-elementos">
                                                <div class="lista-produtos-nome-li-titulo">
                                                    <span id="produtoFrios${i}">${itens.nomeProduto}</span>
                                                </div>
                                                <div class="lista-produtos-nome-li-binario">
                                                    <div class="container-bolinhas">
                                                        ${bolinhas}
                                                    </div>
                                                </div>
                                            </div>
                                `

                }
            });
        } else {
            throw ('Houve um erro na API!');
        }
    }).catch(function (resposta) {
        console.error(resposta);
    });
        }


function buscarDadosBolinhas() {
    faltaTotal = 0;
    var idEmpresa = sessionStorage.ID_EMPRESA;

    fetch(`/bolinhas/listarDadosCuidados/${idEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
            if (resposta.status == 204) {
              Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Nenhum produto encontrado!',
          })
            }
            resposta.json().then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));
                arrayBolinhas = [];
                for (let i = 0; i < resposta.length; i++) {
                    var bolinhas = resposta[i].dados_cuidados;

                    arrayBolinhas.push(bolinhas)
                }
                buscarNomeProdutos();
            });
        } else {
            throw ('Houve um erro na API!');
        }
    }).catch(function (resposta) {
        console.error(resposta);
    });
}

setInterval(() => buscarDadosBolinhas, 16000);

  function mostrarFaltaTotal() {
    kpi_dado_estoqueCuidados.innerHTML = faltaTotal;

    if (faltaTotal <= 0) {
      div_kpi_dadoEstoque.classList.remove('verde-lima');
      div_kpi_dadoEstoque.classList.remove('amarelo');
      div_kpi_dadoEstoque.classList.remove('vermelho');
      div_kpi_dadoEstoque.classList.add('verde');
    } else if (faltaTotal <= 1) {
      div_kpi_dadoEstoque.classList.remove('verde');
      div_kpi_dadoEstoque.classList.add('verde-lima');
      div_kpi_dadoEstoque.classList.remove('vermelho');
      div_kpi_dadoEstoque.classList.remove('amarelo');
    } else if (faltaTotal <= 2) {
      div_kpi_dadoEstoque.classList.remove('verde');
      div_kpi_dadoEstoque.classList.remove('verde-lima');
      div_kpi_dadoEstoque.classList.remove('vermelho');
      div_kpi_dadoEstoque.classList.add('amarelo');
    } else {
      div_kpi_dadoEstoque.classList.remove('verde-lima');
      div_kpi_dadoEstoque.classList.remove('amarelo');
      div_kpi_dadoEstoque.classList.add('vermelho');
      div_kpi_dadoEstoque.classList.remove('verde');
    }
  }

  function mostrarkpi() {

    var idEmpresa = sessionStorage.ID_EMPRESA;

    fetch(`/kpigeral/kpisdosetorCuidados/${idEmpresa}`).then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Nenhuma prateleira encontrada!',
          })
        }
        resposta.json().then(function (resposta) {
          console.log("Dados recebidos: ", JSON.stringify(resposta));

          for (let i = 0; i < resposta.length; i++) {
            var produto = resposta[i];

            kpi_dadoSetorCuidados.innerHTML = `${produto.conta}% `

            if (produto.conta < 75) {
              div_kpi_dado.classList.remove('verde');
              div_kpi_dado.classList.remove('verde-lima');
              div_kpi_dado.classList.remove('amarelo');
              div_kpi_dado.classList.add('vermelho');
            } else if (produto.conta < 85) {
              div_kpi_dado.classList.remove('verde');
              div_kpi_dado.classList.remove('verde-lima');
              div_kpi_dado.classList.remove('vermelho');
              div_kpi_dado.classList.add('amarelo');
            } else if (produto.conta < 95) {
              div_kpi_dado.classList.remove('verde');
              div_kpi_dado.classList.remove('amarelo');
              div_kpi_dado.classList.remove('vermelho');
              div_kpi_dado.classList.add('verde-lima');
            } else {
              div_kpi_dado.classList.remove('verde-lima');
              div_kpi_dado.classList.remove('amarelo');
              div_kpi_dado.classList.remove('vermelho');
              div_kpi_dado.classList.add('verde');
            }
          }
        });
      } else {
        throw ('Houve um erro na API!');
      }
    }).catch(function (resposta) {
      console.error(resposta);
    });

    setTimeout(() => mostrarkpi(), 16000);
  }

  function kpiAunsencia() {

    var idEmpresa = sessionStorage.ID_EMPRESA;

    fetch(`/kpigeral/kpiAunsenciaCuidados/${idEmpresa}`).then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          Swal.fire({
          icon: 'error',
          title: 'Ops...',
          text: 'Nenhuma prateleira encontrada!',
          })
        }
        resposta.json().then(function (resposta) {
          console.log("Dados recebidos: ", JSON.stringify(resposta));

          for (let i = 0; i < resposta.length; i++) {
            var ProdutoAusencia = resposta[i];

            kpi_dado_ausencia.innerHTML = `${ProdutoAusencia.falta_cuidados}`

            if (ProdutoAusencia.falta_cuidados <= 1) {
              div_kpi_dadoAusencia.classList.remove('verde-lima');
              div_kpi_dadoAusencia.classList.remove('amarelo');
              div_kpi_dadoAusencia.classList.remove('vermelho');
              div_kpi_dadoAusencia.classList.add('verde');
            } else if (ProdutoAusencia.falta_cuidados <= 3) {
              div_kpi_dadoAusencia.classList.remove('verde');
              div_kpi_dadoAusencia.classList.remove('vermelho');
              div_kpi_dadoAusencia.classList.remove('amarelo');
              div_kpi_dadoAusencia.classList.add('verde-lima');
            } else if (ProdutoAusencia.falta_cuidados <= 5) {
              div_kpi_dadoAusencia.classList.remove('verde');
              div_kpi_dadoAusencia.classList.remove('vermelho');
              div_kpi_dadoAusencia.classList.remove('verde-lima');
              div_kpi_dadoAusencia.classList.add('amarelo');
            } else {
              div_kpi_dadoAusencia.classList.remove('verde-lima');
              div_kpi_dadoAusencia.classList.remove('amarelo');
              div_kpi_dadoAusencia.classList.remove('verde');
              div_kpi_dadoAusencia.classList.add('vermelho');
            }

          }
        });
      } else {
        throw ('Houve um erro na API!');
      }
    }).catch(function (resposta) {
      console.error(resposta);
    });

    setTimeout(() => kpiAunsencia(), 16000);
  }
</script>